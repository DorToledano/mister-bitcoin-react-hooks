import { storageService } from '../services/storage.service'
import axios from 'axios'

export const bitcoinService = {
  getRate,
  getMarketPrice,
  getConfirmedTransactions,
}

const KEY_RATE = 'rate'
const KEY_MP = 'market-price'
const KEY_CT = 'Confirmed-Transactions'

async function getRate() {
  let currRate = storageService.load(KEY_RATE)
  console.log('from chache')
  if (!currRate) {
    try {
      const res = await axios.get(
        'https://blockchain.info/tobtc?currency=USD&value=1'
      )
      currRate = res.data
      storageService.store(KEY_RATE, currRate)
      console.log('Rate from api')
    } catch (err) {
      console.log('Could not get rate', err)
    }
  }
  return currRate
}

async function getMarketPrice() {
  let marketPrice = storageService.load(KEY_MP)
  if (!marketPrice) {
    try {
      const res = await axios.get(
        'https://api.blockchain.info/charts/market-price?timespan=1week&format=json&cors=true'
      )
      // const res = await axios.get('https://api.blockchain.info/charts/market-price?timespan=5months&format=json&cors=true')
      marketPrice = res.data.values
      storageService.store(KEY_MP, marketPrice)
    } catch (err) {
      console.log('Could not get market price', err)
    }
  }
  return marketPrice
}

async function getConfirmedTransactions() {
  //https://api.blockchain.info/charts/transactions-per-second?timespan=5weeks&format=json&cors=true
  //Return chart data
  let confirmedTransactions = storageService.load(KEY_CT)
  if (!confirmedTransactions) {
    try {
      const res = await axios.get(
        `https://api.blockchain.info/charts/avg-block-size?timespan=5months&format=json&cors=true`
      )
      confirmedTransactions = res.data.values
      storageService.store(KEY_CT, confirmedTransactions)
    } catch (err) {
      console.log('Could not get confirmed transactions', err)
    }
  }
  return confirmedTransactions
}

// async function getConfirmedTransactions() {
//   const storedBlockSizes = storageService.load(KEY_CT)
//   if (storedBlockSizes) return storedBlockSizes
//   try {
//     const response = {"x":1668816000,"y":1.4969349047619043},{"x":1668902400,"y":1.424174744966443},{"x":1668988800,"y":1.4224287286821715},{"x":1669075200,"y":1.4230335317460314},{"x":1669161600,"y":1.474427063829787},{"x":1669248000,"y":1.5717014186046514},{"x":1669334400,"y":1.506700536585366},{"x":1669420800,"y":1.5199759816513767},{"x":1669507200,"y":1.1504716102941175},{"x":1669593600,"y":1.336178187050359},{"x":1669680000,"y":1.3612361221374047},{"x":1669766400,"y":1.2482112971014487},{"x":1669852800,"y":1.255363392156863},{"x":1669939200,"y":1.3924808799999993},{"x":1670025600,"y":1.3185752137404583},{"x":1670112000,"y":1.0863777000000001},{"x":1670198400,"y":1.246357904109589},{"x":1670284800,"y":1.3289437259259254},{"x":1670371200,"y":1.0295061976744189},{"x":1670457600,"y":1.004454652694611},{"x":1670544000,"y":1.180113157894737},{"x":1670630400,"y":1.2850532597402602},{"x":1670716800,"y":0.9720994421768707},{"x":1670803200,"y":1.200833188811189},{"x":1670889600,"y":1.1195085212121214},{"x":1670976000,"y":1.2053584324324325},{"x":1671062400,"y":1.235629726618705},{"x":1671148800,"y":1.183964853846154},{"x":1671235200,"y":1.2896539782608694},{"x":1671321600,"y":0.9801544137931034},{"x":1671408000,"y":1.3223222941176473},{"x":1671494400,"y":1.3143528285714288},{"x":1671580800,"y":1.2201296153846155},{"x":1671667200,"y":1.2444939999999993},{"x":1671753600,"y":1.2620145833333334},{"x":1671840000,"y":1.4493130561797747},{"x":1671926400,"y":0.9879369787234047},{"x":1672012800,"y":1.1192635116279068},{"x":1672099200,"y":1.3764050521739133},{"x":1672185600,"y":1.026325125},{"x":1672272000,"y":1.2632121843971629},{"x":1672358400,"y":1.3564298101265828},{"x":1672444800,"y":1.0717108461538463},{"x":1672531200,"y":0.8427004903225808},{"x":1672617600,"y":1.0212204935897442},{"x":1672704000,"y":1.2482563701298697},{"x":1672790400,"y":1.2244501678321678},{"x":1672876800,"y":1.1550252165605093},{"x":1672963200,"y":1.0527042888888885},{"x":1673049600,"y":0.9565663636363639},{"x":1673136000,"y":0.9051754509803915},{"x":1673222400,"y":1.2354843881578947},{"x":1673308800,"y":1.3784992485207108},{"x":1673395200,"y":1.2952269591836736},{"x":1673481600,"y":1.3506500198675497},{"x":1673568000,"y":1.278143056603773},{"x":1673654400,"y":1.1134006608187137},{"x":1673740800,"y":0.8761467300613498},{"x":1673827200,"y":1.260744619047619},{"x":1673913600,"y":1.2421233589743588},{"x":1674000000,"y":1.3392869071428561},{"x":1674086400,"y":1.2959688896551727},{"x":1674172800,"y":1.293477098484848},{"x":1674259200,"y":1.177075246376812},{"x":1674345600,"y":1.1015247947019866},{"x":1674432000,"y":1.1005096139240504},{"x":1674518400,"y":1.3420454263565889},{"x":1674604800,"y":1.0009242571428576},{"x":1674691200,"y":1.1061077999999993},{"x":1674777600,"y":1.1416405779220786},{"x":1674864000,"y":0.9601554166666668},{"x":1674950400,"y":0.9890340559006203},{"x":1675036800,"y":1.331806333333333},{"x":1675123200,"y":1.5394536000000008},{"x":1675209600,"y":1.5758903795620436},{"x":1675296000,"y":1.4260836068965514},{"x":1675382400,"y":1.4617055563909778},{"x":1675468800,"y":1.7588637720588232},{"x":1675555200,"y":1.6290970592105256},{"x":1675641600,"y":2.203473168918918},{"x":1675728000,"y":2.142792676056337},{"x":1675814400,"y":2.108701760869565},{"x":1675900800,"y":2.1439365370370354},{"x":1675987200,"y":2.0646328843537427},{"x":1676073600,"y":2.3520763892617444},{"x":1676160000,"y":2.5247853664596285},{"x":1676246400,"y":2.162067403846153},{"x":1676332800,"y":2.3363439740259726},{"x":1676419200,"y":2.19020936196319},{"x":1676505600,"y":2.10664605027933},{"x":1676592000,"y":2.048259181818183},{"x":1676678400,"y":2.1140637500000006},{"x":1676764800,"y":2.2633263580246914},{"x":1676851200,"y":2.14595393877551},{"x":1676937600,"y":2.0447599341317373},{"x":1677024000,"y":1.8940469357142848},{"x":1677110400,"y":2.0143520760233917},{"x":1677196800,"y":1.8418406740740745},{"x":1677283200,"y":1.8469322429906543},{"x":1677369600,"y":2.0821476726190475},{"x":1677456000,"y":1.633578385714286},{"x":1677542400,"y":1.8567157956204379},{"x":1677628800,"y":2.1105205823529407},{"x":1677715200,"y":2.0244970972222234},{"x":1677801600,"y":2.0046007559523806},{"x":1677888000,"y":2.1456095197368406},{"x":1677974400,"y":1.9336509612903225},{"x":1678060800,"y":1.8099567272727275},{"x":1678147200,"y":2.018768618181817},{"x":1678233600,"y":1.9805633082706766},{"x":1678320000,"y":1.825581814814815},{"x":1678406400,"y":1.8360665294117648},{"x":1678492800,"y":2.271631206060606},{"x":1678579200,"y":2.3566546397515524},{"x":1678665600,"y":2.0660502038216557},{"x":1678752000,"y":1.8130728219178092},{"x":1678838400,"y":1.952574421768707},{"x":1678924800,"y":1.985878835820895},{"x":1679011200,"y":1.9005259047619045},{"x":1679097600,"y":2.2621394320987656},{"x":1679184000,"y":2.320146466216215},{"x":1679270400,"y":2.0032644545454543},{"x":1679356800,"y":1.9889303517241388},{"x":1679443200,"y":2.161154075471699},{"x":1679529600,"y":2.4930217049180334},{"x":1679616000,"y":2.4300912283950598},{"x":1679702400,"y":2.090348034482757},{"x":1679788800,"y":2.2801207083333335},{"x":1679875200,"y":1.882243087837836},{"x":1679961600,"y":1.8151441417910448},{"x":1680048000,"y":2.014914578231293},{"x":1680134400,"y":2.052353406451612},{"x":1680220800,"y":1.7939797801418438},{"x":1680307200,"y":1.8131560857142859},{"x":1680393600,"y":1.8760888859060403},{"x":1680480000,"y":1.7378229923664124},{"x":1680566400,"y":1.7823777839506174},{"x":1680652800,"y":1.829118741007194},{"x":1680739200,"y":1.9575785124999996},{"x":1680825600,"y":1.8807727323943666},{"x":1680912000,"y":2.2177743945578237},{"x":1680998400,"y":1.984282883561644},{"x":1681084800,"y":1.6222206178861787},{"x":1681171200,"y":1.666888201298702},{"x":1681257600,"y":1.9372407937500007},{"x":1681344000,"y":1.7926685140845071},{"x":1681430400,"y":1.7771835642857152},{"x":1681516800,"y":1.8359778797468347},{"x":1681603200,"y":1.870822879032258},{"x":1681689600,"y":1.7898713096774204}
//     // const response = await axios.get(
//     //   `https://api.blockchain.info/charts/avg-block-size?timespan=5months&format=json&cors=true`
//     // )
//     const data = response.data
//     storageService.save(BLOCK_SIZE_KEY, data)
//     return data
//   } catch (err) {
//     console.error('Error getting block size:', err)
//     return null
//   }
// }
